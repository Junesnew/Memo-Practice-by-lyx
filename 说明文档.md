# 说明文档

### 元气骑士森林关卡简介

本次游戏实现了元气骑士的森林关卡，玩家需要操控骑士角色（wasd八方向）进行闯关，鼠标左键普通攻击，右键释放技能，使用F键进行互动，滑动滚轮可以切换武器。这个游戏总共五层，每一层有若干房间，包括初始房间，敌人房间，特殊房间，传送门房间和奖励房间。

### 实现的要求

1：UI只实现了一部分
2：忘了实现奖励房间中的机关房间
3：精英怪房间里忘了放武器箱子（其实加一行代码就好）
4：除此之外，基础要求基本全部实现，加分项中实现了子弹池；

#### 怪物

1：大部分怪物：包括哥布林枪手，弓箭手，祭司（散弹），野猪（近战），狂暴的野猪（持续近战攻击，攻击时速度增加），大型哥布林（360°射出快速的子弹），蓝藻花（不可移动，全方位射出子弹，子弹先快后慢），水晶：金矿与能量矿；

2：怪物Ai：怪物有两种行动模式：远程与近战
		远程：远离玩家时随机方向移动，靠近玩家时会试图逃跑；
		近战：远离玩家时随机游荡，到达一定距离会追随玩家；

3：掉落物：随机金币或能量球，玩家靠近会吸收；
精英怪的掉落概率更高；

4：精英状态：体型巨大，攻击力与攻击频率增加

5：雇佣兵：虽然是友军但是实现方式跟怪物类似；
佣兵ai：远离玩家时向玩家方向移动，但不会过于靠近玩家；固定间隔，发射随机方向（前方30°以内），随机速度的子弹，方向为鼠标指向方向（看起来就像帮玩家打怪一样）

#### 玩家

1：一个骑士角色，初始携带破旧的手枪，用WSAD控制角色八向移动，鼠标移动控制人物的瞄准 方向，左键开火，右键技能。
2：鼠标滚轮切换武器。F键实现与物体的互动，包括：捡起/购买武器，捡起血瓶蓝瓶，进入传送门；打开箱子；总之所有要互动的地方都是狂按F键；
（PS：F键有时不灵敏，没反应的话离开再走近重新试一下）

3：手刀，靠近敌人攻击变为手刀

4：补充：游戏中有一个跟随玩家的Collector对象，此对象透明，碰撞箱覆盖玩家，用于检测靠近玩家的对象；游戏中的拾取金币/武器/血瓶，手刀，购买雇佣兵，进入传送门等全部由此对象实现；

#### 武器

1：大部分类型的武器：包括：小破枪；弓；散弹枪；火箭炮；法杖；刀剑等

2：武器在地上是睡眠状态。该状态下不攻击

3：手刀本质上是一个透明的武器，由Collector控制睡眠状态

3：补充：武器和敌人都有一个公用的Weaponpara和EnemyPara脚本，这两个脚本用于传递信息和记录参数，相当于与其他物体互动的“接口”；武器参数有isSleep，price，num编号；敌人参数有damage受到伤害，isElite，isDeath，Room归属房间

4：再补充：敌人与武器都有一个父类（Weapon和Enemy），用于实现公有功能，不同的功能在继承类里实现；（ps：弓是单独实现的）

#### 子弹

1：子弹池：游戏中大量出现的普通子弹都被放在子弹池里；子弹池用一个栈实现，发射子弹时，出栈并setactive子弹消失时setactive false，压栈；

2：子弹的实现，子弹命中物体时会检测物体类型（按标签），并作出相应的反应；例如碰到玩家或怪物会扣除玩家血量，碰到箱子会破坏箱子，碰到墙体消失；子弹通过自身标签PlayerBullet和Enemy'Bullect来区分自身类型；避免误伤友军

3：特殊子弹：箭，爆炸，斩击，大型斩击，毒圈，拳击，锤击（锤击忘了做进游戏里...）；由于出现频率低没有放进子弹池，由代码单独生成；
实现逻辑相似。instantiate生成预设子弹，子弹播放动画并造成相应效果，一定时间后消除（Destory）自身；

4：普通子弹遇上斩击等会消失

#### 背景

1：地图：n次尝试自动生成地图失败后放弃，改为用TileMap手动绘制；

2：TileMap分为墙体，地板，和门（每一个房间的门单独绘制）；

3：特殊物体：箱子系列：普通，爆炸，毒，钉子；
地板：加速地板和减速地板，图钉地板
武器箱子：随机给予武器

4：引用Prafabs Brush来绘制特殊物体

5：怪物房和门：用一个覆盖怪物房间的碰撞箱检测玩家的进入，进入后随机生成随机波数的怪物，清理完毕后打开门并随机位置生成箱子；

6：神秘商贩：卖武器等；

7：传送门：由SaveLoad（我本来想用这个做存档来着...）在场景之间传递信息；这个脚本保存蓝量血量，主副武器（忘了保存金币数...）

#### UI（部分）

1：暂停游戏，继续游戏

2：死亡后，弹出Gameover，点击重新开始游戏；

3：开场界面，点击进入游戏；

4：血条蓝条盾条，金币数，武器价格（按F键关闭）

### 引用的插件

TileMap Extras

### 代码架构

其实上面都说的差不多了，再补充一下吧；
由于代码水平有限，代码写的可能不够好。很多代码是一块一块补上的，有的用于计数的int bool数都写在全局了。因为在代码里复制粘贴了很多，很多变量名跟实际作用不匹配，比如说Collector中的mainweopon是从Player里复制来的，但实际上是用来实现手刀的；

1：代码大致分为几个部分，Player，Weapon，Enemy，Collector，Back，Bullect；

2：Player和Collector是一体的，共同实现玩家功能，Collector文件夹还包括开箱子，能量球与金币，捡瓶子，进入传送门（Portal）的功能，

3：Weapon是所有武器类的父类，weaponpara用于传递参数。Enemy的结构类似

4：Back：实现箱子系列机关；box控制所有的箱子，箱子用Clear函数来被破坏，破坏时根据自身名字的不同来发挥相应功能；其中Room是用来控制怪物房的，EliteRoom同理，只是把精英怪几率提升至1；

5：Bullect：子弹池，子弹移动，特殊子弹都在这里；子弹移动也包含了攻击，破坏箱子等；每一个特殊子弹单独实现但代码架构相同，下面的Create函数并没有实现而是被复制到别的脚本里直接调用；